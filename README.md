# RuID (v2) ‚Äì Rust ‚Ä¢ Re-ID üì∏ü¶Ä

An end-to-end **edge-first person-tracking pipeline** written in safe,
async Rust.  It targets **Raspberry Pi 4/5** and x86-64 while
keeping every stage swappable.

* **Zero-copy** camera capture ‚Üí GPU inference  
* Modular crates (`ruid-camera`, `ruid-preprocess`, `ruid-detect`, ‚Ä¶)  
* **Static-quant INT8** models for real-time FPS on Arm A72 + VC6/V3D  

Full design: [`ARCHITECTURE.md`](ARCHITECTURE.md).

---

## üå≥ Repository layout

| Path / crate                | Purpose                                                         |
| --------------------------- | --------------------------------------------------------------- |
| `crates/ruid-camera`        | GStreamer/libcamera capture ‚Üí `Stream<DmaBufFrame>`             |
| `crates/ruid-preprocess`    | Resize + normalize kernels (OpenCL & NEON; CPU fallback)        |
| `crates/ruid-detect`        | YOLOv8-nano INT8 inference (Tract backend)                      |
| `crates/ruid-reid`          | ResNet-50 (IBN) embeddings for Re-ID                            |
| `crates/ruid-track`         | BYTE-Track multi-object tracker (pure Rust)                     |
| `edge-client/`              | CLI binary tying all edge crates together                       |
| `hub-server/`               | gRPC + REST API + Web UI; stores & clusters embeddings          |
| `models/`                   | Pre-quantised ONNX models (generated by `scripts/export_models.py`) |
| `scripts/`                  | Helper scripts (export & quantise models, tooling)              |

---

## üöÄ Quick start (PC)

```bash
# 1. Dependencies (Ubuntu/Debian)
sudo apt-get install gstreamer1.0-libav gstreamer1.0-plugins-{good,bad} \
                     libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
                     clang pkg-config vulkan-loader mesa-opencl-icd

# 2. Fetch & quantise models (~30 s)
python3 scripts/export_models.py

# 3. Build everything
cargo build --release --workspace

# 4. Run edge pipeline with live preview
cargo run -p edge-client -- \
        --model models/yolov8n_int8.onnx \
        --preview \
        --trace info
```

Benchmarks will be posted sometime soon.

---

## üöÄ Quick start (Raspberry Pi 4/5 64-bit)

```bash
# Install packages
sudo apt-get update
sudo apt-get install -y gstreamer1.0-libav gstreamer1.0-plugins-good \
                        gstreamer1.0-plugins-bad libopencl-clang-dev \
                        clang pkg-config libgstreamer1.0-dev

# Cross-compile from PC
rustup target add aarch64-unknown-linux-gnu
cargo build --release --workspace --target aarch64-unknown-linux-gnu

# Copy binary + models to Pi and run
./edge-client --model yolov8n_int8.onnx
```

Use `--gpu off` to force CPU path for benchmarking.

---

## üèóÔ∏è  Building / quantising models

The model choice is arbitrary, but I used these. Please pay attention to model licensing before redistributing.

```bash
python3 scripts/export_models.py
```

The script:

1. Downloads **YOLOv8-nano** and exports 224 √ó 224 ONNX.  
2. Performs **static INT8 quantisation** (QOperator)  
   ‚Üí `models/yolov8n_int8.onnx`.  
3. Builds & quantises a **ResNet-50** ReID backbone.

All resulting ONNX files are Tract-compatible.

---

## üî≠ Roadmap

* [x] Zero-copy DMA-Buf camera ‚Üí GPU path  
* [x] Static-quant INT8 models, Tract backend
* [ ] Single device full pipeline test
* [ ] Multi-device full pipeline test
* [ ] Optimizations galore
* [ ] OpenCL kernels for RP1 NPU (Pi 5)  
* [ ] Multi-sensor support + calibration tool  
* [ ] WebSocket live-view overlay in hub-server UI  
* [ ] OTA updates via GitHub Releases  

---

## ü§ù Contributing

1. Fork & branch from `main`.  
2. Run `cargo fmt` + `cargo clippy --all-targets --all-features`.  
3. Submit a PR with a clear description, screenshots if UI-related.  
4. CI must pass for merge.

---

## üìú License

**Code** is released under the MIT License (see `LICENSE`).  
**Models** retain their upstream licenses (YOLOv8 = AGPL-3.0, torchvision
ResNet = BSD-style).  No warranty; use at your own risk.

---

### Happy hacking! üéâ
